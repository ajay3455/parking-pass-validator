<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gloucester Barcode Scanner</title>
    <!-- QuaggaJS Library for Barcode Scanning -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <style>
        /* Import Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        /* Reset Margins and Padding */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Body Styling */
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #e0f7e9, #b2f2bb);
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* Gloucester Logo */
        .logo {
            width: 150px;
            margin-bottom: 20px;
        }

        /* Scanner Container */
        .scanner-container {
            width: 100%;
            max-width: 400px;
            position: relative;
        }

        /* Video Element */
        #video {
            width: 100%;
            height: auto;
            border-radius: 12px;
            border: 2px solid #2d6a4f;
        }

        /* Overlay for Scanning Area */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .overlay .scan-area {
            border: 4px dashed #d00000;
            width: 80%;
            height: 30%;
            position: absolute;
            top: 35%;
            left: 10%;
            border-radius: 8px;
        }

        /* Phone Number Display */
        .phone-display {
            margin-top: 30px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .phone-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            word-wrap: break-word;
        }

        /* Call Button */
        .call-button {
            display: none; /* Hidden by default */
            padding: 12px 20px;
            font-size: 18px;
            background-color: #2d6a4f;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        .call-button:hover {
            background-color: #1b4332;
        }

        /* Responsive Design */
        @media (max-width: 500px) {
            .logo {
                width: 120px;
            }

            .phone-number {
                font-size: 20px;
            }

            .call-button {
                font-size: 16px;
                padding: 10px 16px;
            }
        }

        /* Status Message */
        .status {
            margin-top: 15px;
            font-size: 16px;
            color: #d00000;
        }
    </style>
</head>
<body>

    <!-- Gloucester Logo -->
    <img src="https://i.imgur.com/LmweghF.png" alt="Gloucester Logo" class="logo">

    <!-- Scanner Section -->
    <div class="scanner-container">
        <video id="video" autoplay></video>
        <div class="overlay">
            <div class="scan-area"></div>
        </div>
    </div>

    <!-- Phone Number Display Section -->
    <div class="phone-display">
        <div class="phone-number" id="phoneNumber">Scan a barcode to get the phone number.</div>
        <a href="#" id="callButton" class="call-button">Call Now</a>
        <div class="status" id="statusMessage"></div>
    </div>

    <script>
        // Initialize QuaggaJS
        function startScanner() {
            if (navigator.mediaDevices && typeof navigator.mediaDevices.getUserMedia === 'function') {
                Quagga.init({
                    inputStream: {
                        type: "LiveStream",
                        constraints: {
                            width: { min: 320 },
                            height: { min: 240 },
                            facingMode: "environment" // Use the back camera
                        },
                        target: document.querySelector('#video') // Or '#yourElement' (optional)
                    },
                    decoder: {
                        readers: ["code_39_reader"] // Specify the barcode format
                    },
                    locate: true
                }, function(err) {
                    if (err) {
                        console.error(err);
                        document.getElementById('statusMessage').innerText = "Error initializing barcode scanner.";
                        return;
                    }
                    Quagga.start();
                });

                Quagga.onDetected(onDetected);
            } else {
                alert("getUserMedia is not supported by your browser.");
            }
        }

        // Handle Detected Barcode
        function onDetected(result) {
            Quagga.offDetected(onDetected); // Stop detecting after first scan
            Quagga.stop();

            const code = result.codeResult.code;
            console.log("Scanned Code:", code);

            // Validate that the scanned code is a valid phone number
            const phoneNumber = validatePhoneNumber(code);

            if (phoneNumber) {
                displayPhoneNumber(phoneNumber);
            } else {
                displayPhoneNumber("Invalid or No Phone Number Found.", false);
            }
        }

        // Validate Phone Number (Assuming it's a 6-digit number or follows a specific pattern)
        function validatePhoneNumber(code) {
            // Example validation: 6-digit number
            const phoneRegex = /^\d{6,15}$/; // Adjust as per your phone number format requirements
            if (phoneRegex.test(code)) {
                return code;
            }
            return null;
        }

        // Display Phone Number and Show Call Button
        function displayPhoneNumber(number, isValid = true) {
            const phoneNumberElement = document.getElementById('phoneNumber');
            const callButton = document.getElementById('callButton');
            const statusMessage = document.getElementById('statusMessage');

            if (isValid) {
                phoneNumberElement.innerText = `Phone Number: ${formatPhoneNumber(number)}`;
                callButton.href = `tel:${number}`;
                callButton.style.display = 'inline-block';
                statusMessage.innerText = "";
            } else {
                phoneNumberElement.innerText = number;
                callButton.style.display = 'none';
                statusMessage.innerText = "Please scan a valid phone number barcode.";
            }
        }

        // Format Phone Number for Display (Optional)
        function formatPhoneNumber(number) {
            // Example formatting: (123) 456-7890
            // Adjust the formatting based on your phone number structure
            if (number.length === 6) {
                return number; // For '000000' or similar
            } else if (number.length === 10) {
                return `(${number.substring(0,3)}) ${number.substring(3,6)}-${number.substring(6)}`;
            }
            return number;
        }

        // Start the scanner on page load
        window.addEventListener('load', startScanner);
    </script>
</body>
</html>
